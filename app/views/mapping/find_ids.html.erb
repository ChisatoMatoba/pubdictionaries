<h1>Find IDs</h1>

<%= form_tag multipart: true do -%>

<h2>Dictionary selection</h2>
<%= render partial: 'dictionary_selection' %>

<h2>Options</h2>
<%= label_tag :threshold %>:
<%= text_field_tag :threshold, 0.7 %>
<br/>
<%= label_tag :rich, "Verbose output" %>
<%= check_box_tag :rich %>

<%= text_field_tag :param1, '', hidden:true %>
<%= text_field_tag :param2, '', hidden:true %>

<h2>URL of REST service</h2>
<%= text_area_tag :rest_url, '', rows: 4, cols: 80 %>

<h2>Demo</h2>
<h3>Labels</h3>
<%= text_area_tag :labels, params[:labels], rows: 4, cols: 80, required: true %><br/>

<%= submit_tag 'Find', class: :button %>
<%= button_tag 'Reset', type: :reset, id: :reset, class: :button %>
<% end %>

<% if @result %>
<h3>Result</h3>
<pre><%= pp @result %></pre>
<% end %>

<script type="text/javascript">
	$(function() {
		set_url();
	});

	$('#threshold').change(function() {
		$('#param1').val('threshold=' + $(this).val());
		set_url();
	});

	$("#rich").change(function() {
		$('#param2').val('rich=' + $(this).is(':checked'));
		set_url();
	});

	$("#reset").click(function() {
		dictionarySelectionReset();
		$('#param1').val('');
		$('#param2').val('');
		set_url();
	});

	function set_url() {
		var param_dics = $('#dictionaries').text().split(',').map(function(v, i){return 'dictionary=' + v}).join('&');
		var param1 = $('#param1').val();
		var param2 = $('#param2').val();

		var params = [];
		if (param1 != '') {params.push(param1)};
		if (param2 != '') {params.push(param2)};

		var url = '<%= root_url %>find_ids' + '?'  + param_dics;
		if (params.length > 0) {url += '&' + params.join('&')}
	  $('#rest_url').text(url);
	}

</script>